# ============================================
# Rose Secret Backend - Variables de Entorno
# ============================================
# Copia este archivo a .env y completa los valores
# NUNCA commitees el archivo .env real

# ============================================
# SERVIDOR
# ============================================
PORT=3000
NODE_ENV=development

# ============================================
# BASE DE DATOS
# ============================================
# Opción 1: PostgreSQL (Producción - Render/Supabase)
# Usar DATABASE_URL para PostgreSQL
DATABASE_URL=postgresql://user:password@host:port/database

# Opción 2: MySQL (Desarrollo local)
# Usar variables individuales para MySQL
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=
DB_NAME=rose_secret
DB_PORT=3306

# ============================================
# JWT (JSON Web Tokens)
# ============================================
# Genera un secreto seguro: openssl rand -base64 32
JWT_SECRET=2wobCIQHdxpMNrutVf/hxwEjPmF0d++EYscsO2a6uRA=
JWT_EXPIRES_IN=7d

# ============================================
# CORS (Frontend URL)
# ============================================
# URL del frontend para permitir requests
FRONTEND_URL=http://localhost:5173
# Múltiples orígenes permitidos (separados por coma)
# En producción: ALLOWED_ORIGINS=https://rosesecret.com,https://www.rosesecret.com
ALLOWED_ORIGINS=http://localhost:5173

# ============================================
# STRIPE (Pagos)
# ============================================
# Obtén tus keys en: https://dashboard.stripe.com/apikeys
# Test keys para desarrollo, Live keys para producción
STRIPE_SECRET_KEY=sk_live_TU_STRIPE_SECRET_KEY_AQUI
STRIPE_PUBLISHABLE_KEY=pk_live_TU_STRIPE_PUBLISHABLE_KEY_AQUI
STRIPE_WEBHOOK_SECRET=whsec_...

# ============================================
# SMS (Twilio)
# ============================================
# Proveedor de SMS: 'twilio', 'aws-sns', o 'mock' (para desarrollo)
SMS_PROVIDER=twilio
# Twilio Account SID (obtén en: https://console.twilio.com/)
TWILIO_ACCOUNT_SID=AC_TU_TWILIO_ACCOUNT_SID_AQUI
# Twilio Auth Token
TWILIO_AUTH_TOKEN=tu_twilio_auth_token_aqui

# OPCIÓN 1: Twilio Verify (RECOMENDADO - No requiere número de teléfono)
# Service SID de Twilio Verify (obtén en: https://console.twilio.com/us1/develop/verify/services)
# Si está configurado, se usará automáticamente en lugar de SMS directo
# Twilio Verify genera y envía códigos automáticamente, más seguro y confiable
TWILIO_VERIFY_SERVICE_SID=VA_tu_twilio_verify_service_sid_aqui

# Mensaje personalizado para SMS de Twilio Verify (opcional)
# IMPORTANTE: El mensaje se puede personalizar de dos formas:
# 1. Desde la consola web (RECOMENDADO): https://console.twilio.com/us1/develop/verify/services
#    - Selecciona tu servicio → "Messaging" o "Templates"
#    - Edita el mensaje de SMS y guarda
#    - El mensaje debe incluir {code} o {Código} donde se insertará el código
# 2. Usando esta variable (se usa si está configurada en cada verificación)
# Ejemplo: "Tu código de verificación Rose Secret es: {code}. Válido por 10 minutos."
# NOTA: Si personalizas desde la consola web, esta variable no es necesaria
TWILIO_VERIFY_MESSAGE=Tu código de verificación Rose Secret es: {code}. Válido por 10 minutos.

# OPCIÓN 2: SMS Directo (Requiere número de Twilio)
# Número de teléfono de Twilio (formato: +1234567890)
# Solo necesario si NO usas Twilio Verify
TWILIO_PHONE_NUMBER=+527774486398

# ============================================
# EMAIL (Resend o Gmail)
# ============================================
# Configura el proveedor de email: 'resend' o 'gmail'
EMAIL_PROVIDER=gmail

# Opción 1: Resend (https://resend.com/api-keys)
# Tier gratuito: 100 emails/día, 3,000 emails/mes
RESEND_API_KEY=re_tu_resend_api_key_aqui

# Opción 2: Gmail con contraseña de aplicación
# 1. Activa la verificación en dos pasos en tu cuenta de Google
# 2. Genera una contraseña de aplicación: https://myaccount.google.com/apppasswords
# 3. Usa tu email de Gmail completo como GMAIL_USER
GMAIL_USER=tu_email@gmail.com
GMAIL_APP_PASSWORD=tu_gmail_app_password_aqui

# Configuración general (usado por ambos proveedores)
EMAIL_FROM_ADDRESS=tu_email@gmail.com
EMAIL_FROM_NAME=Rose Secret

# ============================================
# CLOUDINARY (Imágenes)
# ============================================
# Obtén tu Cloudinary URL en: https://cloudinary.com/console
# Formato: cloudinary://api_key:api_secret@cloud_name
# Ejemplo: cloudinary://123456789012345:abcdefghijklmnopqrstuvwxyz123456@your-cloud-name
CLOUDINARY_URL=cloudinary://tu_api_key:tu_api_secret@tu_cloud_name

# ============================================
# SEGURIDAD Y LOGGING
# ============================================
# Formato de logs (json o text)
LOG_FORMAT=json

# Habilitar debug (solo en desarrollo)
DEBUG=false

# ============================================
# RATE LIMITING Y PROTECCIÓN ANTI-ABUSO
# ============================================
# Habilitar rate limiting
RATE_LIMIT_ENABLED=true

# Modo estricto (límites más bajos)
RATE_LIMIT_STRICT_MODE=false

# Tamaño máximo de body (en bytes, default: 1MB)
MAX_BODY_SIZE=1048576

# Habilitar detección de abuso
ABUSE_DETECTION_ENABLED=true

# Configuración de Rate Limiting por tipo de ruta
# Formato: RATE_LIMIT_{TIPO}_{CONFIGURACION}
# Ventana de tiempo (milisegundos)
RATE_LIMIT_PUBLIC_WINDOW=60000           # 1 minuto - Rutas públicas
RATE_LIMIT_AUTH_WINDOW=900000            # 15 minutos - Autenticación
RATE_LIMIT_PRIVATE_WINDOW=60000          # 1 minuto - Rutas privadas
RATE_LIMIT_ADMIN_WINDOW=900000           # 15 minutos - Admin
RATE_LIMIT_PAYMENT_WINDOW=60000          # 1 minuto - Pagos
RATE_LIMIT_CHECKOUT_WINDOW=60000         # 1 minuto - Checkout
RATE_LIMIT_INTERNAL_WINDOW=60000         # 1 minuto - Health checks
RATE_LIMIT_METRICS_WINDOW=60000          # 1 minuto - Métricas admin
RATE_LIMIT_AUDIT_WINDOW=60000            # 1 minuto - Auditoría admin

# Máximo de requests por ventana
RATE_LIMIT_PUBLIC_MAX=200                # Rutas públicas (GET /products, etc.)
RATE_LIMIT_AUTH_MAX=5                    # Autenticación (login, register)
RATE_LIMIT_PRIVATE_MAX=100               # Rutas privadas (cart, wishlist, orders)
RATE_LIMIT_ADMIN_MAX=60                  # Admin (CRUD productos, órdenes)
RATE_LIMIT_PAYMENT_MAX=10                # Pagos
RATE_LIMIT_CHECKOUT_MAX=10               # Checkout
RATE_LIMIT_INTERNAL_MAX=1000             # Health checks (muy permisivo)
RATE_LIMIT_METRICS_MAX=30                # Métricas admin
RATE_LIMIT_AUDIT_MAX=20                  # Auditoría admin

# Duración de bloqueo tras exceder límite (milisegundos)
RATE_LIMIT_PUBLIC_BLOCK=300000           # 5 minutos
RATE_LIMIT_AUTH_BLOCK=1800000            # 30 minutos
RATE_LIMIT_PRIVATE_BLOCK=300000          # 5 minutos
RATE_LIMIT_ADMIN_BLOCK=1800000           # 30 minutos
RATE_LIMIT_PAYMENT_BLOCK=900000          # 15 minutos
RATE_LIMIT_CHECKOUT_BLOCK=300000          # 5 minutos
RATE_LIMIT_INTERNAL_BLOCK=60000          # 1 minuto
RATE_LIMIT_METRICS_BLOCK=600000          # 10 minutos
RATE_LIMIT_AUDIT_BLOCK=600000            # 10 minutos

# ============================================
# CACHE
# ============================================
# Habilitar/deshabilitar cache globalmente
CACHE_ENABLED=true

# Tamaño máximo del cache en memoria (número de items)
CACHE_MAX_SIZE=500

# TTL por defecto (milisegundos)
CACHE_DEFAULT_TTL=60000

# TTLs específicos por tipo de recurso (milisegundos)
CACHE_TTL_PRODUCTS_LIST=60000      # 60s - Lista de productos
CACHE_TTL_PRODUCT_DETAIL=60000     # 60s - Detalle de producto
CACHE_TTL_CATEGORIES=300000        # 5min - Categorías (cambian poco)
CACHE_TTL_HOME=60000               # 60s - Home page
CACHE_TTL_USER_CART=30000         # 30s - Carrito de usuario
CACHE_TTL_USER_WISHLIST=30000      # 30s - Wishlist de usuario
CACHE_TTL_USER_ORDERS=0            # 0 = NO cachear (datos sensibles)

# ============================================
# NOTAS
# ============================================
# - En producción, usa variables de entorno del hosting
# - JWT_SECRET debe ser único y secreto
# - FRONTEND_URL debe coincidir con la URL de tu frontend
# - STRIPE_WEBHOOK_SECRET se obtiene al crear un webhook en Stripe Dashboard

